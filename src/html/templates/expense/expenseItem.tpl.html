<div id="expensItem">
	<div class="modal-header">
		<a class="close" ng-click="dismiss()">&times;</a>

		<h3 class="modal-title">{{ 'reimbursement.expense.add_expense_item' | translate }}</h3>
	</div>
	<form name="form2">
		<div class="modal-body">
			<div class="row">
				<div class="col-md-12">
					<div class="alert alert-info" ng-show="alert.info.state"><i class="fa fa-info"></i>
						{{alert.info.value}}
					</div>
					<div class="alert alert-success" ng-show="alert.success.state"><i class="fa fa-thumbs-o-up"></i>
						{{alert.success.value}}
					</div>
					<div class="alert alert-danger" ng-show="alert.danger.state">
						<ul ng-bind-html="alert.danger.value | to_trusted"></ul>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-6">
					<div class="form-group">
						<label for="dateExpenseItem">{{ 'reimbursement.expense.date_expense_item' | translate
							}}&nbsp;*</label>

						<div class="input-group">
							<input type="text" name="dateExpenseItem" id="dateExpenseItem" class="form-control"
								   datepicker-popup="dd.MM.yyyy"
								   ng-model="expenseItem.date"
								   is-open="opened"
								   ng-required="true"
								   ng-change="calculateAmount()"
								   ng-disabled="expenseItemAttachmentPath"
								   close-text="Close"/>

							<div class="input-group-addon" ng-click="open($event)"><i class="fa fa-calendar"></i></div>
						</div>
					</div>
				</div>
			</div>

			<div class="row margin-top-10">
				<div class="col-md-4">
					<div class="dropdown">
						<label for="account">{{'reimbursement.expense.category' | translate}}&nbsp;*</label>
						<button id="account" class="btn btn-default dropdown-toggle" type="button" id="category"
								data-toggle="dropdown"
								aria-expanded="true"
								ng-disabled="expenseItemAttachmentPath">
							<span
								ng-if="expenseItem.costCategory.name != null">{{expenseItem.costCategory.name.de}}</span>
							<span
								ng-if="expenseItem.costCategory.name == null">{{'reimbursement.expense.category' | translate}}</span>

							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu" role="menu" aria-labelledby="category">
							<li ng-repeat="a in costCategories" role="presentation"><a role="menuitem" tabindex="-1"
																					   ng-click="expenseItem.costCategory = a">{{a.name.de}}</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<div class="row margin-top-15">
				<div class="col-md-3">
					<label for="amountOriginal">{{'reimbursement.expense.amount' | translate }}&nbsp;*</label>
					<input type="text" name="original" id="amountOriginal" class="form-control"
						   ng-class="{'red-border': !expenseItem.amount.originalAmount && !form2.original.$pristine}"
						   ng-model="expenseItem.amount.originalAmount" ui-number-mask="2"
						   ng-disabled="expenseItem.date == null || expenseItemAttachmentPath"
						   ng-blur="calculateAmount()" required>
				</div>
				<div class="col-md-3">
					<label for="amount" style="font-weight:100;">{{'reimbursement.expense.select_currency' | translate
						}}&nbsp;*</label>
					<input type="text" name="currency" ng-model="expenseItem.amount.currency"
						   typeahead-on-select='onSelect($item)'
						   ng-class="{'red-border': (expenseItem.amount.currency === undefined && !form2.currency.$pristine)}"
						   typeahead="c.cc for c in currencies | filter:$viewValue | limitTo:8" class="form-control"
						   ng-disabled="expenseItem.date == null || expenseItemAttachmentPath"
						   ng-blur="calculateAmount()" required>
				</div>
				<div class="col-md-2">
					<label for="exchangeRate" style="font-weight:100;">{{'reimbursement.expense.exchange_course' |
						translate
						}}</label>
					<input type="text" id="exchangeRate" class="form-control" name="field"
						   ng-model="expenseItem.amount.exchange_rate"
						   ui-number-mask="2"
						   ng-disabled="expenseItem.date == null || expenseItemAttachmentPath">
				</div>
				<div class="col-md-3">
					<label for="amount" style="font-weight:100;">{{'reimbursement.expense.amount_in_chf' | translate
						}}</label>
					<input type="text" id="amount" class="form-control" name="field"
						   ng-model="expenseItem.amount.calculatedAmount"
						   ui-number-mask="2" disabled>
				</div>
			</div>

			<div class="row margin-top-10">
				<div class="col-md-4">
					<div class="form-group">
						<label for="project">{{'reimbursement.expense.cost_centre' | translate }}&nbsp;*</label>

						<div class="input-group">
							<!--<div class="input-group-addon">{{expense_item.cost_center.prefix}}</div>-->
							<input type="text" id="project" class="form-control" name="project"
								   ng-model="expenseItem.project"
								   ng-disabled="expenseItemAttachmentPath" required>
						</div>
					</div>
				</div>
			</div>

			<div class="row margin-top-10">
				<div class="col-md-11">
					<label for="reason">{{'reimbursement.expense.travel_purpose' | translate }}&nbsp;*</label>
					<textarea name="reason" id="reason"
							  ng-model="expenseItem.reason"
							  ng-disabled="expenseItemAttachmentPath"
							  class="form-control" rows="3" maxlength="250" required></textarea>
					<small class="float-right">{{expense_item.reason.length}}{{'reimbursement.expense.max_length' |
						translate:'{ max_length:
						250 }'}}
					</small>
				</div>
			</div>

			<div class="row margin-top-10" ng-if="!expenseItemAttachmentPath">
				<div class="col-md-11">
					<div class="alert alert-info"><i class="fa fa-info"></i>
						{{'reimbursement.expense.save_first' | translate}}
					</div>
				</div>
			</div>
			<div class="row margin-top-10" ng-if="expenseItemAttachmentPath">
				<div class="col-md-6">
					<div
						flow-name="flow.attachment"
						flow-init="{target: expenseItemAttachmentPath, testChunks: false, singleFile: true, simultaneousUploads: 1}"
						flow-files-submitted="$flow.upload()"
						flow-upload-started="initUpload()"
						flow-file-success="showUploadResult(true)"
						flow-file-error="showUploadResult(false)">

						<label for="upload">{{'reimbursement.expense.document_upload' | translate }}</label>
						<!--<input type="file" id="upload" class="form-control" name="field" flow-btn/>-->
						<button ng-if="!expenseItemUploadSucceeded || filename === undefined" type="file"
								class="btn btn-primary" name="field" ng-disabled="expenseItemUploading"
								flow-btn>
							<i ng-if="!expenseItemUploading" class="fa fa-plus-circle"></i>
							<i ng-if="expenseItemUploading" class="fa fa-circle-o-notch fa-spin"></i>
							{{'reimbursement.expense.document_upload.button' | translate }}
						</button>
						<button ng-if="expenseItemUploadSucceeded && filename !== undefined"
								class="btn btn-danger" name="field" type="file" flow-btn>
							<i class="fa fa-times-circle-o"></i>
							{{'reimbursement.expense.document_upload.button_replace' | translate:'{document: filename}'
							}}{{filename}}
						</button>
					</div>
				</div>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-default" ng-click="dismiss()">
				<i class="fa fa-times"></i>
				{{ 'reimbursement.expense.cancel' | translate }}
			</button>
			<button class="btn btn-primary" ng-click="saveExpenseItem(form2,true)"
					ng-disabled="expenseItemUploadSucceeded">
				<i class="fa fa-file-text-o"></i>
				{{ 'reimbursement.expense.add_document' | translate }}
			</button>
			<button class="btn btn-primary" ng-click="saveExpenseItem(form2,false)">
				<i class="fa fa-check"></i>
				{{ 'reimbursement.expense.save' | translate }}
			</button>
		</div>
	</form>
	{{expenseItem}}
</div>